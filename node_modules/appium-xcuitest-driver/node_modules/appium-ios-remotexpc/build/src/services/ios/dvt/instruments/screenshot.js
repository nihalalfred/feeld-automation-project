import { getLogger } from '../../../../lib/logger.js';
const log = getLogger('Screenshot');
/**
 * Screenshot service for capturing device screenshots
 */
export class Screenshot {
    dvt;
    static IDENTIFIER = 'com.apple.instruments.server.services.screenshot';
    channel = null;
    constructor(dvt) {
        this.dvt = dvt;
    }
    async initialize() {
        if (!this.channel) {
            this.channel = await this.dvt.makeChannel(Screenshot.IDENTIFIER);
        }
    }
    /**
     * Capture a screenshot from the device
     * @returns The screenshot data as a Buffer
     */
    async getScreenshot() {
        await this.initialize();
        await this.channel.call('takeScreenshot')();
        const result = await this.channel.receivePlist();
        if (!result) {
            throw new Error('Failed to capture screenshot: received null response');
        }
        if (!Buffer.isBuffer(result)) {
            throw new Error(`Unexpected response format from getScreenshot: expected Buffer, got ${typeof result}`);
        }
        log.info(`Screenshot captured successfully (${result.length} bytes)`);
        return result;
    }
}
