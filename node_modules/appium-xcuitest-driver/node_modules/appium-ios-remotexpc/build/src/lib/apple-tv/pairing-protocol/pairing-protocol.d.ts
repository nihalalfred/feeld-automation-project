import type { AppleTVDevice } from '../../bonjour/bonjour-discovery.js';
import type { NetworkClientInterface } from '../network/types.js';
import type { PairingProtocolInterface, UserInputInterface } from './types.js';
/** Implements the Apple TV pairing protocol including SRP authentication and key exchange */
export declare class PairingProtocol implements PairingProtocolInterface {
    private readonly networkClient;
    private readonly userInput;
    private static readonly log;
    private _sequenceNumber;
    constructor(networkClient: NetworkClientInterface, userInput: UserInputInterface);
    executePairingFlow(device: AppleTVDevice): Promise<string>;
    private createRequest;
    /**
     * Fragments a buffer into TLV8 items of maximum fragment size
     * @param buffer Buffer to fragment
     * @param type TLV8 type identifier
     * @returns Array of TLV8 items
     */
    private fragmentBuffer;
    /**
     * Creates a nonce buffer with prefix padding
     * @param nonceString The nonce string identifier
     * @returns Padded nonce buffer
     */
    private createNonce;
    /**
     * Performs initial handshake with Apple TV to establish connection
     * Sends handshake request with host options and wire protocol version
     */
    private performHandshake;
    /**
     * Attempts to verify existing pairing credentials with Apple TV
     * Creates pair verification request and handles expected failure for new pairing flow
     */
    private attemptPairVerification;
    /**
     * Initiates manual pairing setup process with Apple TV
     * Sends setup request and receives SRP challenge data
     * @returns Response containing SRP salt and server public key
     */
    private setupManualPairing;
    /**
     * Extracts and validates SRP pairing data from Apple TV response
     * @param response Network response containing pairing data
     * @returns Parsed TLV8 dictionary with SRP challenge components
     * @throws PairingError if pairing data is missing or invalid
     */
    private extractAndValidatePairingData;
    /**
     * Performs SRP authentication using user-provided PIN
     * Prompts for PIN, creates SRP client, sends proof, and validates response
     * @param parsedSRP SRP challenge data from Apple TV
     * @returns Authenticated SRP client with session key
     * @throws PairingError if PIN is incorrect or authentication fails
     */
    private performSRPAuthentication;
    /**
     * Receives and processes M6 pairing completion message from Apple TV
     * Attempts to decrypt and validate final pairing state
     * @param decryptKey Decryption key for M6 encrypted data
     */
    private receiveM6Completion;
    /**
     * Constructs initial handshake request packet
     * Includes host options and wire protocol version for pairing session
     * @returns Handshake request with sequence number 0
     */
    private createHandshakeRequest;
    /**
     * Creates pair verification request with X25519 public key
     * Used to attempt verification of existing pairing credentials
     * @returns Pair verification request with random X25519 key
     */
    private createPairVerificationRequest;
    /**
     * Creates pair verification failed event request
     * Sent after verification attempt to proceed with manual pairing setup
     * @returns Pair verify failed event packet
     */
    private createPairVerifyFailedRequest;
    /**
     * Constructs manual pairing setup request packet
     * Initiates M1/M2 exchange with setup pairing data
     * @returns Setup manual pairing request with host information
     */
    private createSetupManualPairingRequest;
    /**
     * Parses base64-encoded TLV8 response into dictionary
     * Decodes base64 string and converts TLV8 format to key-value pairs
     * @param data Base64-encoded TLV8 data
     * @returns Dictionary mapping TLV8 type numbers to buffer values
     * @throws PairingError if TLV8 parsing fails
     */
    private parseTLV8Response;
    /**
     * Validates SRP response for errors and required challenge data
     * Checks for error codes and verifies presence of salt and public key
     * @param parsedSRP Parsed SRP response dictionary
     * @throws PairingError if response contains errors or missing required data
     */
    private validateSRPResponse;
    /**
     * Initializes SRP client with PIN and server challenge data
     * Sets up identity, salt, and server public key for proof computation
     * @param pin User-provided pairing PIN
     * @param parsedSRP SRP challenge data containing salt and server public key
     * @returns Configured SRP client ready for proof generation
     * @throws PairingError if required SRP data is missing
     */
    private createSRPClient;
    /**
     * Sends M3 message containing SRP proof to Apple TV
     * Includes client public key and computed proof for authentication
     * @param srpClient Configured SRP client with computed proof
     */
    private sendSRPProof;
    /**
     * Validates M4 SRP proof response from Apple TV
     * Checks for authentication errors indicating incorrect PIN
     * @param response Network response containing SRP proof validation result
     * @throws PairingError if PIN authentication failed
     */
    private validateSRPProofResponse;
    /**
     * Sends M5 exchange message with encrypted pairing credentials
     * Includes long-term public key, signature, and device information encrypted with session key
     * @param encryptKey Encryption key derived from session key
     * @param devicePairingID Host device pairing identifier
     * @param ltpk Long-term public key (Ed25519)
     * @param ltsk Long-term secret key (Ed25519)
     * @param sessionKey SRP session key for signature derivation
     * @throws PairingError if M5 message creation fails
     */
    private sendM5Message;
    /**
     * Processes and decrypts M6 completion response from Apple TV
     * Validates pairing completion state and decrypts final exchange data
     * @param m6Response Network response containing M6 completion message
     * @param decryptKey Decryption key for M6 encrypted data
     */
    private processM6Response;
    /**
     * Derives encryption and decryption keys from SRP session key
     * Uses HKDF with pairing-specific salt and info strings
     * @param sessionKey SRP session key from authentication
     * @returns Encryption keys for M5/M6 message exchange
     */
    private deriveEncryptionKeys;
    /**
     * Saves pairing credentials to storage and returns credential path
     * Persists long-term public and private keys for future connections
     * @param device Apple TV device information
     * @param ltpk Long-term public key to save
     * @param ltsk Long-term secret key to save
     * @returns Path to saved pairing credentials file
     */
    private createPairingResult;
}
//# sourceMappingURL=pairing-protocol.d.ts.map